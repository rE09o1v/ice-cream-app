# 🍦 アイスクリーム注文アプリ (1-F_BlueSeal)
 このREADMEファイルは`2025/6/23`に更新されました

## 概要

このアプリは、アイスクリーム店での注文から商品受け渡しまでをデジタル化した注文システムです。お客様が商品を選択して注文し、整理券を受け取り、スタッフがQRコードを読み取って商品を受け渡すまでの一連の流れを管理できます。

## 主な機能

### お客様向け機能
- 🛒 **商品選択・注文**: 商品カタログからアイスクリームを選択して注文
- 📱 **整理券表示**: QRコード付きの整理券を表示
- 🔄 **整理券再表示**: 整理券URLをコピーして後で再表示可能
- ❌ **注文取り消し**: 整理券ページから注文を取り消し可能（在庫も自動的に戻る）
- ✅ **受け渡し完了通知**: 商品受け渡し完了時に感謝メッセージを表示

### スタッフ向け機能
- 📊 **ダッシュボード**: 売上、在庫状況、注文状況をリアルタイム表示
- 📷 **QRコード読み取り**: お客様の整理券をスキャンして注文確認
- 📦 **商品管理**: 商品の追加・編集・削除、在庫管理
- 🖼️ **画像アップロード**: Firebase Storageを使用した商品画像のアップロード・管理
- ❌ **注文取り消し**: 対応中の注文を取り消し可能

## セットアップ

### 1. Firebase設定

1. [Firebase Console](https://console.firebase.google.com/) でプロジェクトを作成
2. Firestore Databaseを有効化
3. **Firebase Storageを有効化**（画像アップロード機能のため）
4. Webアプリを追加して設定情報を取得
5. `src/app/page.js` の `firebaseConfig` を実際の設定に更新

```javascript
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_AUTH_DOMAIN",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_STORAGE_BUCKET",
  messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
  appId: "YOUR_APP_ID"
};
```

### 2. Firebase Storage設定

1. Firebase Consoleで「Storage」を選択
2. 「ルール」タブで以下のセキュリティルールを設定：

```javascript
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    match /product-images/{allPaths=**} {
      allow read: if true;  // 誰でも読み取り可能
      allow write: if request.auth != null || true;  // 開発中は誰でも書き込み可能
    }
  }
}
```

**注意**: 本番環境では適切な認証ルールを設定してください。

### 3. 依存関係のインストール

```bash
npm install
```

### 4. アプリの起動

```bash
npm run dev
```

## 使い方

### お客様の利用方法

#### 1. 商品選択・注文
1. アプリを開く（デフォルトで注文ページが表示）
2. 商品カードから欲しいアイスクリームを選択
3. 「カートに入れる」ボタンをタップ
4. カートアイコンをタップして注文内容を確認
5. 「注文を確定して整理券を受け取る」ボタンをタップ

#### 2. 整理券の確認
- 整理番号とQRコードが表示されます
- 商品受け取り時にこの画面をスタッフに見せてください
- 「整理券URLをコピー」ボタンでURLを保存できます
- 「注文を取り消す」ボタンで注文を取り消すことができます（取り消し後は元に戻せません）

#### 3. 整理券の再表示
- コピーしたURLをブックマークまたはメモに保存しておくと、後で整理券を再表示できます
- 再表示時は注文ステータスに応じて適切なページが表示されます：
  - **対応中**: 整理券ページが表示され、QRコード読み取りを待機
  - **完了済み**: 感謝メッセージページが表示される
  - **取り消し済み**: 注文ページに戻り、取り消し通知が表示される

#### 4. 商品受け取り
- スタッフがQRコードを読み取ると、自動的に感謝メッセージページに切り替わります
- 「新しい注文をする」ボタンで再度注文できます

#### 5. 注文取り消し
- 整理券ページで「注文を取り消す」ボタンをタップ
- 確認ダイアログで「OK」を選択
- 取り消し後は在庫も自動的に戻され、注文ページに戻ります
- **注意**: 取り消し後は元に戻せません

### スタッフの利用方法

#### 1. 管理画面へのアクセス
1. ヘッダーの「管理」タブをタップ
2. パスワードを入力（デフォルト: `staff1fstd`）
3. 管理画面にアクセス

#### 2. ダッシュボードの確認
- **全体の売上**: 完了済み注文の合計売上を表示
- **在庫状況**: 各商品のリアルタイム在庫数を表示
- **注文状況**: 対応中・完了・取り消しの注文数を表示
- **最新注文一覧**: 最新10件の注文を表示

#### 3. QRコード読み取り
1. 「QRスキャン」ボタンをタップ
2. お客様の整理券のQRコードをカメラにかざす
3. 注文内容を確認
4. 「受け渡し完了」ボタンをタップ

#### 4. 商品管理
1. 「商品管理」ボタンをタップ
2. 商品の追加・編集・削除が可能
3. 在庫数の調整も可能

#### 5. 画像アップロード機能
- **画像選択**: 「画像を選択」ボタンから商品画像をアップロード
- **対応形式**: JPEG、PNG、WebP（5MB以下）
- **プレビュー**: アップロード前に画像プレビューを表示
- **自動削除**: 商品削除時に画像も自動的に削除
- **代替入力**: 画像URLを直接入力することも可能

#### 6. 注文取り消し
- 最新注文一覧で「対応中」の注文に「取り消し」ボタンが表示
- 取り消し時は在庫も自動的に戻されます

## 技術仕様

### フレームワーク
- **Next.js**: Reactベースのフルスタックフレームワーク
- **Tailwind CSS**: スタイリング
- **Firebase**: バックエンド（Firestore、Storage、認証）

### 主要ライブラリ
- **html5-qrcode**: QRコード読み取り
- **lucide-react**: アイコン
- **firebase/firestore**: データベース操作
- **firebase/storage**: 画像ストレージ

### データ構造

#### 商品 (products)
```javascript
{
  id: "商品ID",
  name: "商品名",
  price: 価格,
  stock: 在庫数,
  imageUrl: "画像URL（Firebase Storageまたは外部URL）"
}
```

#### 注文 (orders)
```javascript
{
  id: "注文ID",
  items: [商品リスト],
  totalAmount: 合計金額,
  createdAt: 作成日時,
  ticketNumber: 整理番号,
  status: "pending|completed|cancelled",
  completedAt: 完了日時（完了時のみ）
}
```

## 画像アップロード機能について

### 機能概要
- Firebase Storageを使用した商品画像のアップロード・管理
- 商品管理画面から画像をアップロード可能
- アップロードした画像は商品カードに表示

### 対応形式・制限
- **対応形式**: JPEG、PNG、WebP
- **ファイルサイズ**: 5MB以下
- **保存場所**: Firebase Storage (`product-images/` フォルダ)

### 料金について
Firebase Storageの料金体系（2024年時点）：
- **無料枠**: 5GBのストレージ、1GB/日のダウンロード
- **従量課金**: 無料枠を超えた場合
  - ストレージ: $0.026/GB/月
  - ダウンロード: $0.12/GB

### セキュリティ
- 画像は公開アクセス可能（商品表示のため）
- 本番環境では適切な認証ルールを設定することを推奨

## 注意事項

### セキュリティ
- 管理画面のパスワードは適切に管理してください
- パスワードを変更したい場合は別途ご連絡ください
- Firebase Storageのセキュリティルールを適切に設定してください

### パフォーマンス
- 画像は最適化されたサイズを使用してください
- 大きな画像ファイルはアップロード前にリサイズすることを推奨

### 開発期間中
- 継続的に開発を進めるのでテストデータの内容(商品名、画像、在庫数)が変わることがあります

## トラブルシューティング

### よくある問題

#### お客様がスマートフォンを持っていない
- スタッフが代わりに注文する
- 整理券番号は小さな紙に書いて渡す
- QRコードを読まずに管理画面から受け渡し完了にする(実装予定)

#### QRコードが読み取れない
- カメラの権限を確認
- 明るい環境で読み取りを試行
- QRコードが汚れていないか確認
- 注文が取り消されていないか確認（取り消し済みの場合は読み取れません）

#### 注文が反映されない
- インターネット接続を確認
- ブラウザを再読み込み

#### 管理画面にアクセスできない
- パスワードを確認
- ブラウザのキャッシュをクリア
- 再度ログインを試行

#### 注文取り消しができない
- 注文が既に完了していないか確認
- インターネット接続を確認
- ブラウザを再読み込みして再試行

#### 整理券を再表示しても画面が変わらない
- インターネット接続を確認
- ブラウザを再読み込み
- 注文ステータスを確認（完了済みや取り消し済みの場合は適切なページが表示されます）
- URLが正しくコピーされているか確認

#### 画像がアップロードできない
- ファイルサイズが5MB以下か確認
- 対応形式（JPEG、PNG、WebP）か確認
- インターネット接続を確認
- Firebase Storageが有効化されているか確認
- ブラウザのキャッシュをクリアして再試行

#### 画像が表示されない
- 画像URLが正しいか確認
- Firebase Storageのセキュリティルールを確認
- 画像ファイルが削除されていないか確認
- ブラウザのキャッシュをクリアして再試行

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## サポート

問題や質問がある場合は、速やかにご連絡いただくか、GitHubのIssuesページでお知らせください。
